<div class="customer-card">
    <!-- 固定显示客户姓名、归属人、是否入群和意向程度 -->
    <h3 class="customer-name">{{ customer.name }}</h3>
    <p><strong>归属人:</strong> {{ customer.created_by.username }}</p>
    <p><strong>是否入群:</strong> {% if customer.is_joined %}是{% else %}否{% endif %}</p>
    <p><strong>意向程度:</strong> <span class="customer-intention">{{ customer.intention }}</span></p>

    <!-- 客户描述 -->
    <div class="customer-description">
        <h4>客户描述:</h4>
        <p>{% if customer.description %}{{ customer.description }}{% else %}暂无描述{% endif %}</p>
    </div>

    <!-- 评论记录 -->
    <div class="comments-section">
        <h4 class="section-title">评论记录:</h4>
        <ul class="comments-timeline">
            {% for comment in customer.comments.all %}
            <li class="comment-item">
                <div class="comment-meta">
                    <strong>{{ comment.created_by.username }}</strong> 于 
                    <span class="comment-date">{{ comment.created_at|date:"Y-m-d H:i" }}</span>
                </div>
                <div class="comment-content">{{ comment.content }}</div>
            </li>
            {% empty %}
            <li class="no-comments">暂无评论。</li>
            {% endfor %}
        </ul>
    </div>

    <!-- 添加评论功能 -->
    <div class="add-comment-section">
        <button class="add-comment-btn" data-customer-id="{{ customer.id }}">添加评论</button>
        <div class="add-comment-form-container" style="display: none;">
            {% csrf_token %}
            <textarea class="comment-content" placeholder="输入评论内容..." required></textarea>
            <button class="submit-comment-btn" data-customer-id="{{ customer.id }}">提交评论</button>
        </div>
    </div>

    <!-- 点击后显示更多详情 -->
    <div class="customer-details" style="display: none;">
        <p><strong>电话:</strong> <a href="tel:{{ customer.phone }}">{{ customer.phone }}</a></p>
        <p><strong>学员期数:</strong> {{ customer.student_batch }}</p>
        <p><strong>数据来源:</strong> {{ customer.data_source }}</p>
        <p><strong>创建时间:</strong> {{ customer.created_at|date:"Y-m-d H:i" }}</p>
        <!-- 链接到编辑客户页面 -->
        <a href="{% url 'edit_customer' customer.id %}" class="edit-customer-btn">编辑客户</a>
    </div>

    <!-- 切换详情按钮 -->
    <button class="toggle-details">显示更多详情</button>
</div>